{% if isajax() %}
{% include "user/posts.html" with {'posts': posts} %}
{% else %}
<div class="main mt5" id="content">
	<div class="inner" id="posts">
{% if posts|length > 0 %}	
{% include "user/posts.html" with {'posts': posts} %}
{% else %}
<div id="loading" class="center">No Dish to Display! :(</div>
{% endif %}

	</div>
		<div id="loading" style="text-align: center;display: none;">
		Loading....
		</div>
		<div id="stoploading" style="text-align: center;display: none;">
		No more dishes
		</div>
</div>
<script type="text/javascript">
$(document).ready(function() {
	var request;
	var win = $(window);
	
	var pp = 1
	
	var page = 2
	var hasmore = true;
	// Each time the user scrolls
	win.scroll(function() {
	if(hasmore){
		// End of the document reached?
		if ($(document).height() - win.height() == win.scrollTop()) {
			pp++;			
			if(pp > page){
				console.log('abort')
				return true
			}
				
			$('#loading').show();
			var path = window.location.pathname;
			
			$.ajax({
				url: path 
				+'/page/'+ page
				,
				dataType: 'html',
				success: function(html) {
					if( html.trim() == '' ){
						$('#stoploading').show();
						$('#loading').hide();
						hasmore = false;
					}
					else
						$('#posts').append(html);
						page++;
						pp = page-1
					$('#loading').hide();
				}
			});
		}
	}
	});
	
});
</script>
{% endif %}